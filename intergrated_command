#for h24 folder data;#1)trim;for i in /Volumes/Seagate/More_RNA/h24/2-infec-24_S2_R1_001.fastq.gz /Volumes/Seagate/More_RNA/h24/3-infec-24_S3_R1_001.fastq.gz /Volumes/Seagate/More_RNA/h24/4-infec-24_S4_R1_001.fastq.gz /Volumes/Seagate/More_RNA/h24/TU114-oocysts_S9_R1_001.fastq.gz /Volumes/Seagate/More_RNA/h24/1-infec-24_S1_R1_001.fastq.gz;do;java -jar /Users/yiranli/Desktop/tools/Trimmomatic-0.36/trimmomatic-0.36.jar SE $i ${i%.fastq.gz}_trimmed.fastq.gz ILLUMINACLIP:/Users/yiranli/Desktop/tools/Trimmomatic-0.36/adapters/TruSeq3-SE.fa:2:30:10 LEADING:5 TRAILING:5 SLIDINGWINDOW:4:5 MINLEN:25 -threads 8 -trimlog ${i%.fastq.gz}.trimlog;done;;#2)mapping;for i in  /Volumes/Seagate/More_RNA/h24/1-infec-24_S1_R1_001_trimmed.fastq.gz /Volumes/Seagate/More_RNA/h24/2-infec-24_S2_R1_001_trimmed.fastq.gz /Volumes/Seagate/More_RNA/h24/3-infec-24_S3_R1_001_trimmed.fastq.gz /Volumes/Seagate/More_RNA/h24/4-infec-24_S4_R1_001_trimmed.fastq.gz /Volumes/Seagate/More_RNA/h24/TU114-oocysts_S9_R1_001_trimmed.fastq.gz;do;hisat2 -p 8 --dta --mp 12,4 --score-min L,0,-0.6 --rdg 6,6 --rfg 6,6  --no-softclip --max-intronlen 3000 --rna-strandness R --phred33 -x /Users/yiranli/Desktop/CryptoDB-32_CparvumIowaII_Genome.fasta -U $i --summary-file ${i%.fastq.gz}_hisat_summary -S ${i%.fastq.gz}.sam;done;;#3)reform to bam;for i in $(ls /Volumes/Seagate/More_RNA/h24/*.sam);do;samtools view -Su -F 4 -q 10 -@ 8 $i |samtools sort -@ 10 - -o ${i%.sam}_sorted.bam;done;;#4)assembly;for i in $(ls *trimmed_sorted.bam);do;stringtie -p 8 -G /Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII.gff -o /Users/yiranli/Desktop/paper_prep/${i%bam}gff -A /Users/yiranli/Desktop/paper_prep/${i%bam}abundance --rf -j 5 -c 10 -g 1 -l ${i%_trimmed_sorted.bam} $i;done;;#for Gal_h2 folder data;#1)trim;for i in $(ls /Volumes/Seagate/More_RNA/Gal_h2/*.gz) ;do;java -jar /Users/yiranli/Desktop/tools/Trimmomatic-0.36/trimmomatic-0.36.jar SE $i ${i%.fastq.gz}_trimmed.fastq.gz ILLUMINACLIP:/Users/yiranli/Desktop/tools/Trimmomatic-0.36/adapters/TruSeq3-SE.fa:2:30:10 LEADING:5 TRAILING:5 SLIDINGWINDOW:4:5 MINLEN:25 -threads 8 -trimlog ${i%.fastq.gz}.trimlog;done;#2)mapping #3)reform to bam;for i in  $(ls /Volumes/Seagate/More_RNA/Gal_h2/*trimmed.fastq.gz);do;hisat2 -p 8 --dta --mp 12,4 --score-min L,0,-0.6 --rdg 6,6 --rfg 6,6  --no-softclip --max-intronlen 3000 --rna-strandness R --phred33 -x /Users/yiranli/Desktop/CryptoDB-32_CparvumIowaII_Genome.fasta -U $i --summary-file ${i%.fastq.gz}_hisat_summary -S ${i%.fastq.gz}.sam;samtools view -Su -F 4 -q 10 -@ 8 ${i%.fastq.gz}.sam |samtools sort -@ 10 - -o ${i%.fastq.gz}_sorted.bam;done;;hisat2 -p 8 --dta -x /Users/yiranli/Desktop/cpar_tran -1 /Users/yiranli/Desktop/48h_S1_mapped_R1_trimmed.fastq -2 /Users/yiranli/Desktop/48h_S1_mapped_R2_trimmed.fastq --rna-strandness RF --summary-file hisat_summary_48h_S1 -S cpar_48h_S1_hisat2.sam;;;;#3)assembly;for i in $(ls *trimmed_sorted.bam);do;stringtie -p 8 -G /Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII.gff -o /Users/yiranli/Desktop/paper_prep/${i%bam}gff -A /Users/yiranli/Desktop/paper_prep/${i%bam}abundance --rf -j 5 -c 10 -g 1 -l ${i%_trimmed_sorted.bam} $i;done;cd  /Users/yiranli/Desktop/very_cleaned_reads;for i in $(ls *.bam);do;stringtie -p 8 -G /Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII.gff -o /Users/yiranli/Desktop/paper_prep/${i%bam}gtf -A /Users/yiranli/Desktop/paper_prep/${i%bam}abundance --rf -j 5 -c 10 -g 1 -l ${i%_hisat2.sort.bam} $i;done;;#4)merge;#taco merge;gffread /Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII.gff -T -o /Users/yiranli/Desktop/paper_prep/CryptoDB-38_CparvumIowaII.gtf;#the h24 rna-seq is weird,not like cpar,so remove them;rm gtf_files;for i in $(ls /Users/yiranli/Desktop/paper_prep/stringtie_result/*.gtf);do echo $i>>gtf_files;done;/Users/yiranli/Desktop/tools/taco-v0.7.3.OSX_x86_64/taco_run -p 8 -o /Users/yiranli/Desktop/paper_prep/taco_merge --gtf-expr-attr TPM /Users/yiranli/Desktop/paper_prep/gtf_files ;#self merge to remove redundant genes;echo -e "/Users/yiranli/Desktop/paper_prep/taco_merge/assembly.gtf\n/Users/yiranli/Desktop/paper_prep/taco_merge/assembly.gtf" >/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.txt;python2.7 /Users/yiranli/Desktop/tools/cufflinks-2.2.1.OSX_x86_64/cuffmerge -o /Users/yiranli/Desktop/paper_prep/taco_cuff_merge  /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.txt;cp /Users/yiranli/Desktop/paper_prep/taco_cuff_merge/merged.gtf /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gtf;#transfer to gff and some strand issue fixed;gffread -E /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gtf -o- >/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff;#filter alternative splicing and keep one isoform;cat /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff |awk '{if($3=="transcript") print}'|grep -E -o "geneID=XLOC_\d+"|sort|uniq -c|grep -v "1 gene"|cut -f5 -d " ">/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.ALT.list;grep -f /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.ALT.list /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff |cut -f9|sed 's/;/\t/g'|sort -k2|sort -u -k2,2 --merge |grep -E -o "TCONS_\d+">keep;grep -f /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.ALT.list /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff |grep -E -o "TCONS_\d+">remove;grep -v -f remove /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff >/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff1;grep -f keep /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff >/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff2;cat /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff1 /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff2 >/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff;#the results looks good!;#fix some strand problem found bu ht-seq;;#seperate lncRNA from mRNA;bedtools intersect -a /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff -b /Users/yiranli/Desktop/CryptoDB_38_mRNA.gff -s -wa|grep -E -o "TCONS_\d+"|sort|uniq>/Users/yiranli/Desktop/paper_prep/mrna.list;grep -f /Users/yiranli/Desktop/paper_prep/mrna.list /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff >/Users/yiranli/Desktop/paper_prep/mRNA.gff;grep -v  -f /Users/yiranli/Desktop/paper_prep/mrna.list /Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff >/Users/yiranli/Desktop/paper_prep/lncRNA.gff;;#add intron;/Users/yiranli/Desktop/tools/genometools-1.5.9/bin/gt gff3 -addintrons yes /Users/yiranli/Desktop/paper_prep/lncRNA.gff >/Users/yiranli/Desktop/paper_prep/lncRNA_intron_added.gff;#extract transcript sequence;gffread -w /Users/yiranli/Desktop/paper_prep/lncRNA.fa -g /Users/yiranli/Desktop/CryptoDB-32_CparvumIowaII_Genome.fasta /Users/yiranli/Desktop/paper_prep/lncRNA.gff;gffread -w /Users/yiranli/Desktop/paper_prep/mRNA.fa -g /Users/yiranli/Desktop/CryptoDB-32_CparvumIowaII_Genome.fasta /Users/yiranli/Desktop/paper_prep/mRNA.gff;#transdecoder;;#########lncFinder########;https://rdrr.io/cran/LncFinder/man/compute_GC.html;library("LncFinder");library("seqinr");seq_mRNA<-read.fasta(file="/Users/yiranli/Desktop/paper_prep/mRNA.fa");seq_lncRNA<-read.fasta(file="/Users/yiranli/Desktop/paper_prep/lncRNA.fa");referFreq <- make_referFreq(cds.seq = seq_mRNA, lncRNA.seq = seq_lncRNA, k = 6, step = 1,alphabet = c("a", "c", "g", "t"), on.orf = TRUE,ignore.illegal = TRUE);frequencies<-make_frequencies(cds.seq=seq_mRNA,lncRNA.seq=seq_lncRNA, SS.features = FALSE,cds.format = "DNA", lnc.format = "DNA", check.cds = TRUE,ignore.illegal = TRUE);mRNA_features <- extract_features(seq_mRNA, label = "coding",SS.features = FALSE, format = "DNA",frequencies.file = frequencies,parallel.cores = 2);lncRNA_features <- extract_features(seq_lncRNA, label = "noncoding",SS.features = FALSE, format = "DNA",frequencies.file = frequencies,parallel.cores = 2);mRNA_FickettScore<-compute_FickettScore(seq_mRNA, label = "coding", on.ORF = FALSE,auto.full = FALSE, parallel.cores = 2);lncRNA_FickettScore<-compute_FickettScore(seq_lncRNA, label = "noncoding", on.ORF = FALSE,auto.full = FALSE, parallel.cores = 2);#the hexamer score not good, all zero;lncRNA_hexamerScore<-compute_hexamerScore(seq_lncRNA, label = "noncoding", referFreq=referFreq, k = 6,step = 1, alphabet = c("a", "c", "g", "t"), on.ORF = TRUE,auto.full = FALSE, parallel.cores = 2);mRNA_hexamerScore<-compute_hexamerScore(seq_mRNA, label = "coding", referFreq=referFreq, k = 6,step = 1, alphabet = c("a", "c", "g", "t"), on.ORF = TRUE,auto.full = FALSE, parallel.cores = 2);##make figures;library("ggplot2");ggplot()+geom_density(aes(x=log(mRNA_features$ORF.Max.Len)),color="red")+geom_density(aes(x=log(lncRNA_features$ORF.Max.Len)),color="blue");ggplot()+geom_density(aes(x=mRNA_features$ORF.Max.Cov),color="red")+geom_density(aes(x=lncRNA_features$ORF.Max.Cov),color="blue");ggplot()+geom_density(aes(x=mRNA_FickettScore$Fickett.Score),color="red")+geom_density(aes(x=lncRNA_FickettScore$Fickett.Score),color="blue");;;#5)count;cd /Volumes/Seagate/More_RNA/Gal_h2/;for i in $(ls *.bam);do;htseq-count -f bam -t transcript -r pos -s reverse -i ID $i \;/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff \;>/Users/yiranli/Desktop/paper_prep/count_cryptoDB_gene/${i%_trimmed_sorted.bam}_all_features_count;done;;##count for translation test;cd /Volumes/Seagate/More_RNA/Gal_h2/;for i in $(ls *.bam);do;htseq-count -f bam -t gene -r pos -s reverse -i ID $i \;/Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII_reverse.gff \;> /Users/yiranli/Desktop/paper_prep/count_cgd_all/${i%_trimmed_sorted.bam}_noncoding_count;done;;cd /Volumes/Seagate/More_RNA/h24/;for i in $(ls *.bam);do;htseq-count -f bam -t transcript -r pos -s reverse -i ID $i \;/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff \;>/Users/yiranli/Desktop/paper_prep/count_cryptoDB_gene/${i%_trimmed_sorted.bam}_all_features_count;done;;cd /Users/yiranli/Desktop/very_cleaned_reads/;for i in $(ls *.bam);do;htseq-count -f bam -t transcript -r pos -s reverse -i ID $i \;/Users/yiranli/Desktop/paper_prep/taco_cuffmerge.gff \;>/Users/yiranli/Desktop/paper_prep/count_cryptoDB_gene/${i%_trimmed_sorted.bam}_all_features_count;done;;#merge count file;mv *_all_features_count /Users/yiranli/Desktop/paper_prep/count_all_feature/;cd /Users/yiranli/Desktop/paper_prep/count_all_feature/;cat /Users/yiranli/Desktop/paper_prep/count_all_feature/TU114-oocysts_S9_R1_001_all_features_count |cut -f1|grep TCO|sort>/Users/yiranli/Desktop/paper_prep/count_all_feature/all_0;a=0;for i in $(ls *); do let a=$a+1;let b=$a-1;join all_${b} $i >all_${a}; echo "${a}_${i}">>index_file; done;#put into R to calculate CPM;library(edgeR);all30_count<-read.table("/Users/yiranli/Desktop/paper_prep/count_all_feature/all_30");all27_count<-all30_count[,!names(all30_count) %in% c("V13","V14")];rownames(all27_count)<-all27_count$V1;all27_count$V1<-NULL;colna<-c("h24s1lib1","h24s2lib1","h24s3lib1","h24s4lib1","h0s1lib2","h2s1lib2","h2s2lib2","h2s3lib2","h2s4lib2","h2s5lib2","oocystlib2","h0s2lib2","h0s3lib2","h0s4lib2","h2s6lib2","h2s7lib2","h2s8lib2","h2s9lib2","h2s10lib2","oocystlib1","oocystlib3","h24s1lib3","h24s2lib3","h24s3lib3","h48s1lib3","h48s2lib3","h48s3lib3");colnames(all27_count)<-colna;all27_count<-as.matrix(all27_count);col_groups <- substr(colnames(all27_count), 1, 3);dds <- DESeqDataSetFromMatrix(all27_count, DataFrame(col_groups), ~ col_groups);rld <- rlog(dds);all27_rlog<-assay(rld);write.table(x=all27_rlog, file="/Users/yiranli/Desktop/paper_prep/cluster/all27_rlog",quote = FALSE,sep="\t",col.names = TRUE,row.names = TRUE);all27_cpm<-cpm(all27_count,lib.size=NULL, log=FALSE);write.table(all27_cpm,file="/Users/yiranli/Desktop/paper_prep/cluster/all27_cpm",sep = "\t",quote = FALSE,col.names = FALSE);quantile<-apply(all27_cpm,1,quantile);feature_cpm<-data.frame("max"=quantile[5,],"upper75"=quantile[4,],"median"=quantile[3,],"lower25"=quantile[2,],"min"=quantile[1,],row.names = colnames(quantile));write.table(feature_cpm,file="/Users/yiranli/Desktop/paper_prep/cluster/feature_cpm",sep = "\t",quote = FALSE,col.names = FALSE);;;#calculate variance;variance<-data.frame("variance"=apply(all27_cpm,1,var),row.names = rownames(all27_cpm));coefficent<-function(x) (sd(x)/mean(x));variance$coefficient<-apply(all27_cpm,1,coefficent);variance$mean<-apply(all27_cpm,1,mean);write.table(variance,file="/Users/yiranli/Desktop/paper_prep/cluster/feature_var",sep = "\t",quote = FALSE,col.names = FALSE);#merge;cd /Users/yiranli/Desktop/paper_prep/cluster/;join <(join <(sort feature_length_lnc) <(sort feature_cpm)) <(sort feature_var) |sed 's/ /\t/g'> feature_merge;#calculate pearson correlation;;#make features for cluster;#length;cat /Users/yiranli/Desktop/paper_prep/lncRNA.gff |awk '{if($3=="transcript") print$9"\t"$5-$4}'|sed 's/;/\t/g'|awk '{print$1"\t"$3}'|sed 's/ID=//g'|sort >/Users/yiranli/Desktop/paper_prep/cluster/feature_length_lnc;cat /Users/yiranli/Desktop/paper_prep/mRNA.gff |awk '{if($3=="transcript") print$9"\t"$5-$4}'|sed 's/;/\t/g'|awk '{print$1"\t"$3}'|sed 's/ID=//g'|sort >/Users/yiranli/Desktop/paper_prep/cluster/feature_length_mrna;#ORF;transdecoder on sapelo1;extract longest pep by /Users/yiranli/Desktop/paper_prep/cluster/get_longest_orf.py;interproscan;module load interproscan/5.23-62.0 ;sh /usr/local/apps/interproscan/5.23-62.0/interproscan.sh -appl Pfam -d /home/yl22225/lncRNA.fa.transdecoder_dir/inter_lnc -i transdecoder_lnc_longest_pep.fa;;;;###use cluster to select best lncRNA candidates;#3d plot;cpat results, script /Users/yiranli/Desktop/paper_prep/cluster/cpat2plot3D.py;#R;input_3d<-read.table("/Users/yiranli/Desktop/paper_prep/cluster/input_3d",header = TRUE);library("scatterplot3d");;###select golden dataset for training;ORF:mrna>600,lnc<550;cov:mrna>0.7,lnc<0.35;all_feature<-rbind(lncRNA_features[,c(0,1,2,3)],mRNA_features[,c(0,1,2,3)]);write.table(all_feature,file="/Users/yiranli/Desktop/paper_prep/cluster/all_features",quote = FALSE,sep = "\t",col.names = FALSE);python /Users/yiranli/Desktop/paper_prep/cluster/select_gold_input_lncfinder.py;goldseq_lncRNA<-read.fasta(file="/Users/yiranli/Desktop/paper_prep/cluster/lncrna_gold1.fa");goldseq_mRNA<-read.fasta(file="/Users/yiranli/Desktop/paper_prep/cluster/mrna_gold1.fa");frequencies<-make_frequencies(cds.seq = goldseq_mRNA, lncRNA.seq=goldseq_lncRNA, SS.features = FALSE,cds.format = "DNA", lnc.format = "DNA", check.cds = TRUE,ignore.illegal = TRUE);cpar_lnc_svm<-build_model(lncRNA.seq=goldseq_lncRNA, mRNA.seq=goldseq_mRNA, frequencies.file=frequencies, SS.features = FALSE,lncRNA.format = "DNA", mRNA.format = "DNA", parallel.cores = 2,folds.num = 10, seed = 1, gamma.range = (2^seq(-5, 0, 1)),cost.range = c(1, 4, 8, 16, 24, 32));lncfinder_result_lnc<-lnc_finder(Sequences=seq_lncRNA, SS.features = FALSE, format = "DNA",frequencies.file = frequencies, svm.model = cpar_lnc_svm,parallel.cores = -1);;#remove with pfam hit and high orf_cov,and mRNA annotation;#remove list:TCONS_00002426,TCONS_00004419,TCONS_00002340,TCONS_00000120,TCONS_00002098,;;;;TCONS_00001640,TCONS_00002175,TCONS_00003005,TCONS_00004492,;grep -f /Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_list /Users/yiranli/Desktop/paper_prep/cluster/all27_cpm >/Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_cpm;grep -f /Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_list /Users/yiranli/Desktop/paper_prep/cluster/all27_rlog >/Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_rlog;;;

##in R to make figures;
feature_merge<-read.table("/Users/yiranli/Desktop/paper_prep/cluster/feature_merge",col.names = c("len","max","upper","median","lower","min","var","coef","average"));
feature_length_lnc<-read.table("/Users/yiranli/Desktop/paper_prep/cluster/feature_length_lnc",col.names = "length");
feature_length_mrna<-read.table("/Users/yiranli/Desktop/paper_prep/cluster/feature_length_mrna",col.names = "length");

#length;
ggplot()+geom_density(aes(feature_length_mrna$length),color="red",fill="red",alpha=0.3)+geom_density(aes(feature_length_lnc$length),color="deepskyblue",fill="lightblue",alpha=0.8)+xlim(0,9000)+theme_bw()+xlab("length(bp)");

#ORF;ggplot()+geom_density(aes(mRNA_features$ORF.Max.Len),color="red",fill="red",alpha=0.3)+geom_density(aes(lncRNA_features$ORF.Max.Len),color="deepskyblue",fill="lightblue",alpha=0.8)+xlim(0,5000)+theme_bw()+xlab("ORF(bp)");#ORF_cov;ggplot()+geom_density(aes(mRNA_features$ORF.Max.Cov),color="red",fill="red",alpha=0.3)+geom_density(aes(lncRNA_features$ORF.Max.Cov),color="deepskyblue",fill="lightblue",alpha=0.8)+theme_bw()+xlab("ORF coverage(%)");;


##heatmap;
library(pheatmap);
library(RColorBrewer);
library(viridis);
final_noncoding_rlog<-read.table("/Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_rlog",header = FALSE,sep = "\t",row.names = 1);
colnames(final_noncoding_rlog)<-colna;
final_noncoding_rlog_col <- data.frame(group = col_groups);
rownames(final_noncoding_rlog_col) <- colnames(final_noncoding_rlog);
final_noncoding_rlog_colors <- list(group = brewer.pal(5, "Set2"));
names(final_noncoding_rlog_colors$group) <- unique(col_groups);dat <- data.frame(values = as.numeric(unlist(final_noncoding_rlog)));ggplot(dat, aes(values)) + geom_density(bw = "SJ");quantile_breaks <- function(xs, n = 10) {;  
breaks <- quantile(xs, probs = seq(0, 1, length.out = n));  breaks[!duplicated(breaks)];};final_noncoding_rlog_breaks <- quantile_breaks(unlist(final_noncoding_rlog_v2), n = 11);final_noncoding_rlog_cluster_cols <- hclust(dist(t(final_noncoding_rlog)));library(dendsort);sort_hclust <- function(...) as.hclust(dendsort(as.dendrogram(...)));final_noncoding_rlog_cluster_cols <- sort_hclust(final_noncoding_rlog_cluster_cols);final_noncoding_rlog_cluster_rows <- sort_hclust(hclust(dist(final_noncoding_rlog)));pheatmap(;    mat               = final_noncoding_rlog_v2,;    color             = inferno(length(final_noncoding_rlog_breaks) - 1),;    breaks            = final_noncoding_rlog_breaks,;    border_color      = NA,;    show_colnames     = FALSE,;    show_rownames     = FALSE,;    annotation_col    = final_noncoding_rlog_col,;    annotation_colors = final_noncoding_rlog_colors,;    drop_levels       = TRUE,;    fontsize          = 14,;    main              = "Cpar Noncoding Heatmap",;    cluster_rows      = final_noncoding_rlog_cluster_rows,;    cluster_cols      = final_noncoding_rlog_cluster_cols,;    legend 			=TRUE;);final_noncoding_rlog_cluster_cols<-rotate(final_noncoding_rlog_cluster_cols, c(1:6,9,7:8,10:27));color             = colorRampPalette(brewer.pal(10, "RdYlGn"))(20),;

pheatmap(;    mat               = final_noncoding_rlog,;    color             = color,;    breaks            = final_noncoding_rlog_breaks,;    border_color      = NA,;    show_colnames     = FALSE,;    show_rownames     = FALSE,;    annotation_col    = final_noncoding_rlog_col,;    annotation_colors = final_noncoding_rlog_colors,;    drop_levels       = TRUE,;    fontsize          = 14,;    main              = "Cpar Noncoding Heatmap",;    cluster_cols      = final_noncoding_rlog_cluster_cols,;    legend 			  =TRUE,;    kmeans_k 		   =11;);;;;




###;analysis on 824 lncRNA location distribution;grep -f /Users/yiranli/Desktop/paper_prep/cluster/final_noncoding_list /Users/yiranli/Desktop/paper_prep/lncRNA.gff >/Users/yiranli/Desktop/paper_prep/cluster/final_noncoding.gff;bedtools intersect -a <(cat /Users/yiranli/Desktop/paper_prep/cluster/final_noncoding.gff|awk '{if($3=="transcript") print}') -b <(cat /Users/yiranli/Desktop/CryptoDB-38_CclparvumIowaII.gff|awk '{if($3=="gene") print}') -wao;#how many intergenic lnc 105;bedtools intersect -a <(cat /Users/yiranli/Desktop/paper_prep/cluster/final_noncoding.gff|awk '{if($3=="transcript") print}') -b <(cat /Users/yiranli/Desktop/CryptoDB-38_CparvumIowaII.gff|awk '{if($3=="gene") print}') -wao|cut -f9,18,19|awk '{if($3==0 && $2==".") print}'|grep -o -E 'TCONS_\d+'|sort|uniq >/Users/yiranli/Desktop/paper_prep/cluster/location/intergenic_lnc_list.tab;#how many overlap exactly one annotated gene roughly 533;#how many long lnc that overlap more than mrna 62;#how many short lnc that share a mrna 124;;##test if antisense has something to do with translation;cat /Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog |cut -f1,6-21|sed 's/ /\t/g'|awk '{for (i=2;i<=NF;i++) sum[$1]+=$i} END{for (i in sum) print i,sum[i]/27}'|awk '{if($2>2) print$1}'>/Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2.list;grep -f /Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2.list /Users/yiranli/Desktop/paper_prep/mRNA.gff >/Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2.gff;bedtools intersect -a /Users/yiranli/Desktop/Cpar_BMGF.gff -b /Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2.gff|grep -E -o "cgd\d_\d+"|sort|uniq>/Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2_cgd.list;grep -f /Users/yiranli/Desktop/paper_prep/cluster/final_coding_rlog_2_cgd.list /Users/yiranli/Desktop/paper_prep/genenoprotein.gff >/Users/yiranli/Desktop/paper_prep/cgd_expression_no_protein.list.gff;;#exonerate;exonerate ~/lncRNA.fa $i -n 1 -s 500  --showcigar False --showvulgar False --ryo ">%S %ql %ps\n";##annotate cbai lncRNA;hisat2 -p 8 --phred33 -x /Users/yiranli/Desktop/May_conservation/cbai_hisat -1 /Volumes/Seagate/More_RNA/C_baileyi_TAMU-10GZ1_RNA_1.fastq -2 /Volumes/Seagate/More_RNA/C_baileyi_TAMU-10GZ1_RNA_2.fastq --rna-strandness RF --summary-file /Volumes/Seagate/More_RNA/cbai_hisat_summary -S /Volumes/Seagate/More_RNA/cbai.sam;stringtie -p 8 -o /Volumes/Seagate/More_RNA/clean_cbai_sorted.bam.gff --rf /Volumes/Seagate/More_RNA/clean_cbai_sorted.bam;bedtools getfasta -fi /Users/yiranli/Desktop/cbai_hisat.fasta -bed /Users/yiranli/Desktop/clean_cbai_sorted.bam.gff -s >/Volumes/Seagate/More_RNA/clean_cbai_sorted.bam.fa;#exonerate result;cat /Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result|awk '{if(($3-$2)/$9>0.5 && $10>60) print}';cat /Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result |grep ">TCON"|cut -f1|sed 's/ /\t/g'|cut -f1,2,3,5,6,7,8,9,10,11,12|sort -k1,1 -k8,8gr|sort -u -k1,1 > cbai_855lncRNA_exonerate_result ;cat /Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result|awk '{if($5<$6)print $4"\t"$5"\t"$6"\t"$1"\t100\t"$7;else print$4"\t"$6"\t"$5"\t"$1"\t100\t"$7}'>/Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result.bed;bedtools intersect -a /Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result.bed -b /Volumes/Seagate/More_RNA/clean_cbai_sorted.bam.gff -s >/Users/yiranli/Desktop/paper_prep/cbai1_exonerate.bed;bedtools  intersect -b /Volumes/Seagate/research_big/May_conservation/cbai_855lncRNA_exonerate_result.bed -a /Volumes/Seagate/More_RNA/clean_cbai_sorted.bam.gff -s >/Users/yiranli/Desktop/paper_prep/cbai2_stringtie.gff;grep -f /Users/yiranli/Desktop/paper_prep/lncRNA.list <(cat /Users/yiranli/Desktop/paper_prep/cluster/all27_cpm|cat /Users/yiranli/Desktop/paper_prep/cluster/all27_cpm|awk '{if(($5+$6+$7+$8+$9+$10+$11+$12+$13+$14+$15+$16+$17+$18+$19+$20+$21)>80)print}');$5+$6+$7+$8+$9+$10+$11+$12+$13+$14+$15+$16+$17+$18+$19+$20+$21;;for i in *Genome.fasta; do exonerate ~/lncRNA.fa $i -n 1 -s 500  --showcigar False --showvulgar False --ryo ">%S %ql %ps\n" > ${i}_out; done;--showalignment False --showcigar False --showvulgar False --ryo ">>%qi %ql %qab %qae %ti %tab %tae %tS %s %ps\n" ;query_id query_len query_align_begion query_align_end target_id target_align_begin target_align_end target_strand score similarity ;;exonerate /home/yl22225/lncRNA.fa CryptoDB-40_CbaileyiTAMU-09Q1_Genome.fasta -n 1 -s 500 --showcigar False --showvulgar False --ryo ">%S %ql %ps\n";for i in *_out; do cat $i|grep ">TCON"|sed 's/^>TCON/'"${i%_Genome.fasta_out}"'\tTCON/g'|sed 's/ /\t/g' >>out; done;cat out|sort -k2,2 -k1,1 -k11,11gr|sort -u -k2,2 -k1,1 >out_besthit;##filter tmp for expression print;grep -f /Users/yiranli/Desktop/chromerid/ranking/venn/express/chom.txt <(cat /Users/yiranli/Desktop/chromerid/ranking/inersect.tab|awk '{if($9=="transcript") print}') |grep CryptoDB-40_Chominis30976|cut -d ";" -f1,6|cut -f4,5|sed 's/; TPM "/\t/g'|sed 's/"//g'|awk '{if($2>10) print$1}' >/Users/yiranli/Desktop/chromerid/ranking/venn/express/chom_tpm_10.txt;;;##cufflinks;cufflinks -o /Volumes/Seagate/small_rna/assembly/total/cufflinks/contig1 -p 8 -g /Users/yiranli/Dropbox/new_annotation/Cpar_new_complete_annotation_2018.gff3 --library-type fr-firststrand -I 3000 --min-intron-length 18  --trim-3-avgcov-thresh 50 --trim-3-dropoff-frac 0.75  /Volumes/Seagate/small_rna/mapping/total/q10/contig1_sorted.bam;;;cufflinks -o /Volumes/Seagate/small_rna/assembly/total/cufflinks/contig1 -p 8 --library-type fr-firststrand -I 3000 --min-intron-length 18  --trim-3-avgcov-thresh 200 --trim-3-dropoff-frac 0.85 --min-frags-per-transfrag 200 /Volumes/Seagate/small_rna/mapping/total/q10/contig1_sorted.bam