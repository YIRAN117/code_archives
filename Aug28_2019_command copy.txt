##Aug28_2019;#mappability;Genome=/scratch/yl22225/v6/CryptoDB-32_CparvumIowaII_Genome.fasta;genome_prefix=iowa;;gem-indexer -i $Genome -o ./${genome_prefix};;gem-mappability -I ./${genome_prefix}.gem -o ${genome_prefix}_mappability_l70m0.03indel3min0.9 -l 70 -m 0.03 --min-matched-bases 0.9 --max-big-indel-length 3 -T 6;;gem-2-wig -I ./${genome_prefix}.gem -i ./${genome_prefix}_mappability_l70m0.03indel3min0.9.mappability -o ${genome_prefix}_mappability_l70m0.03indel3min0.9.mappability;;;Genome="/scratch/yl22225/ATCC_genome/CryptoDB-46_CparvumIOWA-ATCC_Genome.fasta";genome_prefix="CparIOWA-ATCC";gem-indexer -i $Genome -o ./${genome_prefix};;;gem-mappability -I ./${genome_prefix}.gem -o ${genome_prefix}_mappability -l 15  -t 10;gem-2-wig -I ./${genome_prefix}.gem -i ./${genome_prefix}_mappability -o ${genome_prefix}_mappability.wig;;;gem-mappability -I ./${genome_prefix}.gem -o ${genome_prefix}_mappability_l70m0.03indel3min0.9 -l 70 -m 0.03 --min-matched-bases 0.9 --max-big-indel-length 3 -T 6;;##Aug31_2019;#Organoid sample;#trimmomatic;cd /Volumes/Seagate/More_RNA/organoid_72h;for i in $(ls *_2.fastq):;do;java -jar /Users/yiranli/Desktop/tools/Trimmomatic-0.36/trimmomatic-0.36.jar SE $i ${i%.fastq}_trimmed.fastq ILLUMINACLIP:/Users/yiranli/Desktop/tools/Trimmomatic-0.36/adapters/TruSeq_smallrna.fa:2:30:10 LEADING:20 TRAILING:20 SLIDINGWINDOW:4:20 MINLEN:25 -threads 8 -trimlog ${i%.fastq}.trimlog;done;#mapping;for i in $(ls *2_trimmed.fastq);do;hisat2 -p 8 --max-intronlen 3000 --rna-strandness F  -x /Users/yiranli/Desktop/CryptoDB-41_CparvumIowaII_Genome.fasta -U $i --summary-file ${i%.fastq}_hisat_summary -S ${i%.fastq}.sam;samtools sort -@ 10 -o ${i%.fastq}.bam ${i%.fastq}.sam;rm ${i%.fastq}.sam;done;;#MDBK sample;#trimmomatic;cd /Volumes/Seagate/More_RNA/MDBK2h24h48h;for i in $(ls *.fastq.gz);do;sudo java -jar /Users/yiranli/Desktop/tools/Trimmomatic-0.36/trimmomatic-0.36.jar SE $i ${i%.fastq.gz}_trimmed.fastq ILLUMINACLIP:/Users/yiranli/Desktop/tools/Trimmomatic-0.36/adapters/TruSeq3-SE.fa:2:30:10 LEADING:20 TRAILING:20 SLIDINGWINDOW:4:20 MINLEN:25 -threads 8 -trimlog ${i%.fastq.gz}.trimlog;sudo hisat2 -p 8 --max-intronlen 3000 --rna-strandness R  -x /Users/yiranli/Desktop/CryptoDB-41_CparvumIowaII_Genome.fasta -U ${i%.fastq.gz}_trimmed.fastq --summary-file ${i%.fastq.gz}_trimmed_hisat_summary -S ${i%.fastq.gz}_trimmed.sam;sudo samtools sort -@ 10 -o ${i%.fastq.gz}_trimmed.bam ${i%.fastq.gz}_trimmed.sam;rm ${i%.fastq.gz}_trimmed.sam;done;;#Sep1_2019;#Organoid sample;#stingtie( the seq so bad, not suitable for good assembly, to assembly to check where the expression are);samtools merge -@ 10 SI_24hr.bam SRR6984248_2_trimmed.bam SRR6984249_2_trimmed.bam SRR6984250_2_trimmed.bam SRR6984251_2_trimmed.bam SRR6984256_2_trimmed.bam SRR6984257_2_trimmed.bam SRR6984258_2_trimmed.bam SRR6984259_2_trimmed.bam SRR6984264_2_trimmed.bam SRR6984265_2_trimmed.bam SRR6984266_2_trimmed.bam SRR6984267_2_trimmed.bam;;samtools merge -@ 10 SI_72hr.bam SRR6984252_2_trimmed.bam SRR6984253_2_trimmed.bam SRR6984254_2_trimmed.bam SRR6984255_2_trimmed.bam SRR6984260_2_trimmed.bam SRR6984261_2_trimmed.bam SRR6984262_2_trimmed.bam SRR6984263_2_trimmed.bam SRR6984268_2_trimmed.bam SRR6984269_2_trimmed.bam SRR6984270_2_trimmed.bam SRR6984271_2_trimmed.bam;;#assembly;cd /Volumes/Seagate/More_RNA/organoid_72h/merged_mapping;for i in $(ls *bam);do;stringtie -p 8 -o /Volumes/Seagate/More_RNA/organoid_72h/stringite/${i%bam}gtf -A /Volumes/Seagate/More_RNA/organoid_72h/stringite/${i%bam}abundance --fr -l ${i%.bam} $i;done;;#MDBK sample;#assembly;cd /Volumes/Seagate/More_RNA/MDBK2h24h48h/mapping;for i in $(ls *bam);do;sudo stringtie -p 8 -o /Volumes/Seagate/More_RNA/MDBK2h24h48h/stringtie/${i%bam}gtf -A /Volumes/Seagate/More_RNA/MDBK2h24h48h/stringtie/${i%bam}abundance --rf -j 5 -l ${i%.bam} $i;done;;#Sep2_2019;#IPEC sample;#assembly;cd /Volumes/Seagate/More_RNA/h24/mapping;for i in $(ls *bam);do;sudo stringtie -p 8 -o /Volumes/Seagate/More_RNA/h24/stringtie/${i%bam}gtf -A /Volumes/Seagate/More_RNA/h24/stringtie/${i%bam}abundance --rf -j 5 -l ${i%.bam} $i;done;;#gal_h2 sample;cd /Volumes/Seagate/More_RNA/Gal_h2/mapping;for i in $(ls *bam);do;sudo stringtie -p 8 -o /Volumes/Seagate/More_RNA/Gal_h2/stringtie/${i%bam}gtf -A /Volumes/Seagate/More_RNA/Gal_h2/stringtie/${i%bam}abundance --rf -j 5 -l ${i%.bam} $i;done;;#gtf list;1)MDBK;Volumes/Seagate/More_RNA/MDBK2h24h48h/stringtie;2)orgnoid;/Volumes/Seagate/More_RNA/organoid_72h/stringite;3)IPEC;/Volumes/Seagate/More_RNA/h24/stringtie;4)gal_h2;/Volumes/Seagate/More_RNA/Gal_h2/stringtie;5)boris;/Users/yiranli/Dropbox/paper_prep/stringtie_result/boris;;#merge;stringtie --merge -T 5 -m 200 -c 10 -g 1  /Volumes/Seagate/More_RNA/master_assembly/gtf_list -o /Volumes/Seagate/More_RNA/master_assembly/gffcompared_c5g10T5.gtf;;#lncRNA seperation, bedtools made mistakes sometimes, better to find mRNA first;cat /Users/yiranli/Desktop/CryptoDB-43_CparvumIowaII.gff |awk '{if($3=="mRNA"||$3=="rRNA"||$3=="tRNA") print}' >/Volumes/Seagate/More_RNA/master_assembly/CryptoDB-43_CparvumIowaII_filtered.gff;;cat /Volumes/Seagate/More_RNA/master_assembly/gffcompared_c5g10T5.gtf |awk '{if($3=="transcript") print} >/Volumes/Seagate/More_RNA/master_assembly/gffcompared_c5g10T5_transcript.gtf ;;bedtools intersect -a /Volumes/Seagate/More_RNA/master_assembly/gffcompared_c5g10T5_transcript.gtf -b /Volumes/Seagate/More_RNA/master_assembly/CryptoDB-43_CparvumIowaII_filtered.gff -s -wa >/Volumes/Seagate/More_RNA/master_assembly/mRNA_tRNA_rRNA_transcript.gtf;;cat /Volumes/Seagate/More_RNA/master_assembly/mRNA_tRNA_rRNA_transcript.gtf |cut -f9|cut -d ";" -f1|awk '{print $2}' >/Volumes/Seagate/More_RNA/master_assembly/mRNA_tRNA_rRNA_transcript.id;;grep -v -f /Volumes/Seagate/More_RNA/master_assembly/mRNA_tRNA_rRNA_transcript.id /Volumes/Seagate/More_RNA/master_assembly/gffcompared_c5g10T5.gtf >/Volumes/Seagate/More_RNA/master_assembly/lncRNA.gtf;;#quantify;1)MDBK;cd /Volumes/Seagate/More_RNA/MDBK2h24h48h/mapping;for i in $(ls *bam);do;sudo stringtie -G /Volumes/Seagate/More_RNA/master_assembly/lncRNA_identification/lncRNA_cryptoDB_merged.gtf --rf -p 8 -A /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_MDBK_${i%_trimmed.bam}.abundance -o /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_MDBK_${i%_trimmed.bam}.gtf $i;done;;2)orgnoid;cd /Volumes/Seagate/More_RNA/organoid_72h/merged_mapping;for i in $(ls *bam);do;sudo stringtie -G /Volumes/Seagate/More_RNA/master_assembly/lncRNA_identification/lncRNA_cryptoDB_merged.gtf --fr -p 8 -A /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_organoid_${i%.bam}.abundance -o /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_organoid_${i%.bam}.gtf $i;done;;3)IPEC;cd /Volumes/Seagate/More_RNA/h24/mapping;for i in $(ls *bam);do;sudo stringtie -G /Volumes/Seagate/More_RNA/master_assembly/lncRNA_identification/lncRNA_cryptoDB_merged.gtf --rf -p 8 -A /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_IPEC_${i%_trimmed_sorted.bam}.abundance -o /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_IPEC_${i%_trimmed_sorted.bam}.gtf $i;done;;;4)Gal_h2;cd /Volumes/Seagate/More_RNA/Gal_h2/mapping;for i in $(ls *bam);do;sudo stringtie -G /Volumes/Seagate/More_RNA/master_assembly/lncRNA_identification/lncRNA_cryptoDB_merged.gtf --rf -p 8 -A /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_Gal_${i%_trimmed_sorted.bam}.abundance -o /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_Gal_${i%_trimmed_sorted.bam}.gtf $i;done;;5)upenn;cd /Users/yiranli/Desktop/very_cleaned_reads;for i in $(ls *bam);do;x=${i#cpar_};sudo stringtie -G /Volumes/Seagate/More_RNA/master_assembly/lncRNA_identification/lncRNA_cryptoDB_merged.gtf --rf -p 8 -A /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_upenn_${i%_trimmed_sorted.bam}.abundance -o /Volumes/Seagate/More_RNA/master_assembly/quan/crypto_lncRNA_upenn_${x%_hisat2.sort.bam}.gtf $i;done;;;#Sep4_2015;#sexual stage samples;#PBS -S /bin/bash;#PBS -q highmem_q;#PBS -N jobname;#PBS -l nodes=1:ppn=4;#PBS -l walltime=48:00:00;#PBS -l mem=100gb;;module load HISAT2/2.1.0-foss-2016b;module load SAMtools/1.9-foss-2016b;module load StringTie/1.3.4d-foss-2016b;;cd /scratch/yl22225/more_rna/sexual_stage/mapping;for i in SRR8841061  ;do;hisat2 -p 8 -x /home/yl22225/genomes/CryptoDB-41_CparvumIowaII_Genome.fasta --max-intronlen 3000 --rna-strandness RF --sra-acc $i --summary-file ./${i}_summary -S sexual_${i}.sam;samtools view -Su -@ 10 -F 4 sexual_${i}.sam |samtools sort -@ 10 - -o sexual_${i}.bam;rm sexual_${i}.sam;done;;for i in  SRR8841053	SRR8841052	SRR8841051	SRR8841050	SRR8841049	SRR8841048	SRR8841047	SRR8841046	SRR8841045	SRR8841044	SRR8841043	SRR8841042	SRR8841041;do;hisat2 -p 8 -x /home/yl22225/genomes/CryptoDB-41_CparvumIowaII_Genome.fasta --max-intronlen 3000 --rna-strandness R --sra-acc $i --summary-file ./${i}_summary -S sexual_${i}.sam;samtools view -Su -@ 10 -F 4 sexual_${i}.sam |samtools sort -@ 10 - -o sexual_${i}.bam;rm sexual_${i}.sam;done;;cd /scratch/yl22225/more_rna/sexual_stage/mapping;for i in $(ls *bam);do;stringtie -p 8 -o /scratch/yl22225/more_rna/sexual_stage/stringtie/${i%bam}gtf -A /scratch/yl22225/more_rna/sexual_stage/stringtie/${i%bam}abundance --rf -l ${i%.bam} $i;done;;#Sep5_2015;module load SAMtools/1.9-foss-2016b;cd /scratch/yl22225/more_rna/sexual_stage/mapping;for i in SRR8841060 SRR8841059 SRR8841058 SRR8841057 SRR8841056  SRR8841055	SRR8841054;do;samtools view -F 4 -b sexual_${i}.bam >sexual_${i}_mapped.bam;rm sexual_${i}.bam;done;;##count;1)MDBK;mkdir -p  ~/MDBK2h24h48h/htseq/ ;cd /Volumes/Seagate/More_RNA/MDBK2h24h48h/mapping;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff  >~/MDBK2h24h48h/htseq/${i%bam}count;done;sudo mv ~/MDBK2h24h48h/htseq/ /Volumes/Seagate/More_RNA/MDBK2h24h48h;;2)orgnoid;mkdir -p  ~/organoid/htseq/ ;cd /Volumes/Seagate/More_RNA/organoid_72h/merged_mapping;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff > ~/organoid/htseq/${i%bam}count;done;sudo mv ~/organoid/htseq/ /Volumes/Seagate/More_RNA/organoid_72h;;;3)IPEC;mkdir -p  ~/IPEC/htseq/;cd /Volumes/Seagate/More_RNA/h24/mapping;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff > ~/IPEC/htseq/${i%bam}count;done;sudo mv ~/IPEC/htseq/ /Volumes/Seagate/More_RNA/h24;;4)gal_h2;mkdir -p  ~/Gal_h2/htseq/;cd /Volumes/Seagate/More_RNA/Gal_h2/mapping;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff > ~/Gal_h2/htseq/${i%bam}count;done;sudo mv ~/Gal_h2/htseq/ /Volumes/Seagate/More_RNA/Gal_h2;;;5)upenn;cd /Users/yiranli/Desktop/very_cleaned_reads;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff > /Users/yiranli/Dropbox/master_assembly/count/${i%bam}count;done;;;6)sexual;mkdir -p ~/sexual/htseq/;cd /Volumes/Seagate/More_RNA/sexual_stage/mapping;for i in $(ls *.bam);do;htseq-count --secondary-alignments ignore --nonunique all -f bam -t exon -r pos -s reverse -i Parent $i /Users/yiranli/Dropbox/master_assembly/list_clean_manually_checked/lncRNA_checked.gff > ~/sexual/htseq/${i%bam}count;done;sudo mv ~/sexual/htseq/ /Volumes/Seagate/More_RNA/sexual_stage/;;$Sep06_2019;#rlog;library(DESeq2);#pca plot;sampleinfo<-read.table("/Users/yiranli/Dropbox/master_assembly/sample_info",header = TRUE);all_count<-read.table("/Users/yiranli/Dropbox/master_assembly/all_count.tab",header = TRUE,row.names = 1);all_count_filtered<-all_count_filtered[rowSums(all_count_filtered)>200,];all_count_dds<- DESeqDataSetFromMatrix(all_count_filtered,colData = sampleinfo_filtered,design = ~1);all_count_rlog <- rlog(all_count_dds,blind = FALSE);all_count_vsd <- vst(all_count_dds, blind=FALSE);pcaData <- plotPCA(all_count_vsd, intgroup=c("time", "group"), returnData=TRUE);percentVar <- round(100 * attr(pcaData, "percentVar"));p<-ggplot(pcaData, aes(PC1, PC2, color=sampleinfo_filtered$time, shape=sampleinfo_filtered$group)) +;  geom_point(size=3) +;  xlab(paste0("PC1: ",percentVar[1],"% variance")) +;  ylab(paste0("PC2: ",percentVar[2],"% variance")) + ;  coord_fixed();gg<-ggplotly(p);api_create(gg);#two layers  ;pcaData_sub=subset(pcaData, pcaData$group.1 == "Gal"& pcaData$time=="0h");pcaData_sub1=subset(pcaData);ggplot() +geom_point(data=pcaData_sub1,size=3,alpha = 1,aes(x=pcaData_sub1$PC1,y=pcaData_sub1$PC2, color=pcaData_sub1$time, shape=pcaData_sub1$group.1)) +xlab(paste0("PC1: ",percentVar[1],"% variance")) +ylab(paste0("PC2: ",percentVar[2],"% variance")) +coord_fixed()+geom_point(data=pcaData_sub,size=3,alpha = 1,aes(x=pcaData_sub$PC1, y=pcaData_sub$PC2, color=pcaData_sub$time, shape=pcaData_sub$group.1));;#make the shape hollow;scale_shape_discrete(solid=F);;#WGCNA;vsd<-assay(all_count_vsd);datExpr<-t(vsd);colnames(datExpr)<- gsub("Cgd","cgd",colnames(datExpr));;;#seq12_2019;#cor;library(Hmisc);all_cor_37samples<-rcorr(x=as.matrix(datExpr_filter),type = "spearman");all_cor_37samples_cor<-all_cor_37samples$r;all_cor_37samples_p<-all_cor_37samples$P;all_cor_37samples_p_fdr<-p.adjust(all_cor_37samples_p,method="fdr");all_cor_37samples_p_fdr<-matrix(all_cor_37samples_p_fdr,nrow=4900);write.table(all_cor_37samples_cor,file="/Users/yiranli/Dropbox/master_assembly/cor/all_cor_37samples_cor",quote = FALSE,sep = "\t",row.names = TRUE,col.names = TRUE);a<-rownames(all_cor_37samples_cor);all_cor_37samples_p_fdr_2<-as.data.frame(all_cor_37samples_p_fdr,row.names = a);colnames(all_cor_37samples_p_fdr_2)<-a;all_cor_37samples_p_fdr<-all_cor_37samples_p_fdr_2;remove(all_cor_37samples_p_fdr_2);write.table(all_cor_37samples_p_fdr,file="/Users/yiranli/Dropbox/master_assembly/cor/all_cor_37samples_p_fdr",quote = FALSE,sep = "\t",row.names = TRUE,col.names =TRUE);python cor_distance.py;#;make figure;lncRNA_mRNA_cor_dis<-read.csv("/Users/yiranli/Dropbox/master_assembly/cor/lncRNA_mRNA_cor_distance",sep="\t",header = TRUE);mRNA_mRNA_cor_dis<-read.csv("/Users/yiranli/Dropbox/master_assembly/cor/mRNA_mRNA_cor_distance",sep="\t",header = TRUE);> mean(abs(lncRNA_mRNA_cor_dis$correlation));[1] 0.3274902;> mean(abs(mRNA_mRNA_cor_dis$correlation));[1] 0.4604691;>filter(lncRNA_mRNA_cor_dis,distance>-1,distance<500,abs(correlation)>0.5,fdr<0.01);#723;ana_dis500_r05_fdr001<-lncRNA_mRNA_cor_dis %>% filter(distance>-1,distance<500,abs(correlation)>0.5,fdr<0.01) %>%arrange(desc(abs(correlation)));ana_dis10000_r05_fdr001<-lncRNA_mRNA_cor_dis %>% filter(distance>-1,distance<10000,abs(correlation)>0.5,fdr<0.001);plot_ly(ana_dis10000_r05_fdr001,x=ana_dis10000_r05_fdr001$distance,y=ana_dis10000_r05_fdr001$correlation);a<-rcorr(x=lncRNA_mRNA_cor_dis$distance,y=lncRNA_mRNA_cor_dis$correlation);> a$r;              x             y;x  1.0000000000 -0.0006096359;y -0.0006096359  1.0000000000;;> a<-rcorr(x=(filter(lncRNA_mRNA_cor_dis,distance>-1))$distance,y=(filter(lncRNA_mRNA_cor_dis,distance>-1)$correlation));> a$r;            x           y;x  1.0000000 -0.0105883;y -0.0105883  1.0000000;> a<-rcorr(x=(filter(lncRNA_mRNA_cor_dis,distance>-1,distance<10000))$distance,y=(filter(lncRNA_mRNA_cor_dis,distance>-1,distance<10000)$correlation));> a$r;           x          y;x  1.0000000 -0.1318853;y -0.1318853  1.0000000;conclusion:dis and cor not correlation generally;;#make cor relationship curve line;#after running up_down_anti_cor.py;up_down_anti_cor<-read.csv("/Users/yiranli/Dropbox/master_assembly/cor/cor_relationship.tab",sep = "\t",header = TRUE);ggplot(up_down_anti_cor,aes(x=cor,color=relationship))+ geom_density(alpha=0.25);;#sep16_2019;beta=8;dynamicColors;     blue     brown turquoise    yellow ;      458        98      4262        82 ;  ;#wgcna to cytospace;modules="blue";moduleColors<-dynamicColors;probes = colnames(datExpr_filter);inModule = is.finite(match(moduleColors, modules));modProbes = probes[inModule];modTOM = TOM[inModule, inModule];dimnames(modTOM) = list(modProbes, modProbes);cyt = exportNetworkToCytoscape(modTOM,edgeFile = paste("CytoscapeInput-edges-", paste(modules, collapse="-"), ".txt", sep=""),nodeFile = paste("CytoscapeInput-nodes-", paste(modules, collapse="-"), ".txt", sep=""),weighted = TRUE,threshold = 0.02,nodeNames = modProbes,nodeAttr = moduleColors[inModule]);;write.table(cyt$nodeData,file = "/Users/yiranli/Dropbox/master_assembly/cor/WGCNA_cyt_node_blue",sep = "\t",quote = FALSE,row.names = FALSE);write.table(cyt$edgeData,file = "/Users/yiranli/Dropbox/master_assembly/cor/WGCNA_cyt_edge_blue",sep = "\t",quote = FALSE,row.names = FALSE);;#ggplot line;#make x label veritical p+theme(axis.text.x = element_text(angle = 90, hjust = 1));1);MSTRG.2406<-as.data.frame(datExpr_filter[,c("MSTRG.2406-RA","mRNA_cgd6_780-RA")]);MSTRG.2406$sample<-rownames(MSTRG.2406);MSTRG.2406_d<-gather(MSTRG.2406,gene,expression_vst,-sample);MSTRG.2406_d$sample<-as.character(MSTRG.2406_d$sample);level_order<-unique(MSTRG.2406_d$sample);MSTRG.2406_d$sample<-factor(MSTRG.2406_d$sample,levels =level_order);ggplot(data=MSTRG.2406_d,aes(x=sample,y=expression_vst,group=gene,color=gene))+geom_line()+scale_colour_manual(values = c("lightseagreen","lightcoral"))+theme(axis.text.x = element_text(angle = 90, hjust = 1));rcorr(x=MSTRG.2406$`MSTRG.2406-RA`,y=MSTRG.2406$`mRNA_cgd6_780-RA`,type="spearman");2)cgd1_2680<-as.data.frame(datExpr_filter[,"mRNA_cgd1_2680-RA"]);cgd1_2680$sample<-rownames(datExpr_filter);;#sep24_2019;after ran /Users/yiranli/Dropbox/scripts/vst2boxplot.py;all_count_vst_table_reshaped<-read.csv("/Users/yiranli/Dropbox/master_assembly/vst/all_count_vst_table_transformed",header = TRUE,sep = "\t");level_order<-c("oocyst","h0","h2","h24","h48","h48_female","h72");all_count_vst_table_reshaped$time<-factor(all_count_vst_table_reshaped$time,levels = level_order);ggplot(all_count_vst_table_reshaped,aes(x=time,y=value,color=type))+geom_boxplot()+scale_colour_manual(values = c("lightcoral","lightseagreen"));;;;;#venn;cat /Users/yiranli/Dropbox/master_assembly/vst/all_count_vst_table_transformed |awk '{if($1 ~/MSTRG/ && $2=="h48_female" && $3 > 2) print $1}';venn(list(oocyst$V1,h0$V1,h2$V1,h24$V1,h48$V1,h48_female$V1,h72$V1), zcolor = "style",ilab=TRUE);;#makefiure lncfinder;ggplot(data = my_dataset,aes(my_dataset$ORF.Max.Cov,group=my_dataset$label,color=label))+geom_density();;ggplot(data = my_dataset,aes(my_dataset$Signal.Peak,group=my_dataset$label,color=label))+geom_density(size=1)+xlim(0,40)+xlab("Signal at 1/3 position")+ylab("density")+theme(axis.text=element_text(size=17), axis.title=element_text(size=17,face="bold"),panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"));#MEME;ml MEME/5.0.0-iomkl-2018a;meme sequences.fa -dna -oc . -nostatus -time 18000 -mod zoops -nmotifs 5 -minw 6 -maxw 200 -objfun classic -revcomp -markov_order 0 ;;#OCT21;#clean the lncRNA list;bedtools intersect -a /Users/yiranli/Dropbox/paper_prep/manuall/manual_lncRNA_exon.gff -b /Users/yiranli/Dropbox/master_assembly/lncRNA_identification/lncRNA.gtf |sort|uniq >/Users/yiranli/Dropbox/master_assembly/list_clean/manual_and_new.gff;;#Nov 13;#seekr and pheatmap;;seekr4<-read.csv("/Users/yiranli/Dropbox/master_assembly/clusering/4mer_lnc_cds/seekr.csv",header = TRUE,row.names = 1);seekr4_t<-gather(seekr4,key="key",value="value");ggplot(data=seekr4_t,aes(x=value,group=key,color=key))+geom_density(show.legend = FALSE);col.pal <- RColorBrewer::brewer.pal((length(breaks) - 1), "Spectral");col.pal <- RColorBrewer::brewer.pal(5, "Spectral");mat_breaks <- seq(-3, 33, length.out = 100);;pal<-colorRampPalette(c(rep("cadetblue1",1),rep("black",5),rep("goldenrod3",7),rep("yellow",15)),bias=1,interpolate="spline")(100);;pheatmap(seekr4,scale = "none",clustering_distance_rows="canberra",clustering_method="average",show_rownames=FALSE,show_colnames=TRUE,color = pal,clustering_distance_cols ="manhattan",fontsize_col = 3,breaks = mat_breaks);;;library(ComplexHeatmap);vec=c(">CM000432:578072-579003(+)",">CM000435:738404-739350(-)",">CM000436:96050-96856(-)",">CM000434:524609-526028(+)",">CM000432:515699-516788(+)",">CM000435:278626-280205(+)",">CM000435:1082045-1083934(+)",">CM000430:931739-932964(-)",">CM000431:1050407-1051129(+)",">CM000434:268762-270598(+)",">CM000434:268762-270598(+)",">CM000434:268762-270598(+)",">CM000430:372866-373944(+)",">CM000432:1098334-1099026(-)",">CM000436:877683-879978(+)",">CM000434:902247-903826(-)",">CM000433:16630-17990(+)",">CM000430:954993-955727(-)",">CM000431:407256-408558(-)");x<-match(vec,rownames(seekr4));ha_right = rowAnnotation(foo = anno_mark(at = x, labels = c("CM000432:578072-579003(+)","CM000435:738404-739350(-)","CM000436:96050-96856(-)","CM000434:524609-526028(+)","CM000432:515699-516788(+)","CM000435:278626-280205(+)",">Cdg7_Flc_0990(+)","CM000430:931739-932964(-)","CM000431:1050407-1051129(+)","CM000434:268762-270598(+)","CM000434:268762-270598(+)","CM000434:268762-270598(+)","CM000430:372866-373944(+)","CM000432:1098334-1099026(-)","CM000436:877683-879978(+)","CM000434:902247-903826(-)","CM000433:16630-17990(+)",">Cdg2_FLc_0220(-)","CM000431:407256-408558(-)"),labels_gp = gpar(col = "black", fontsize = 6)));;ha_top=columnAnnotation(mean_Z_score = anno_barplot(colMeans(seekr4),height = unit(1.5,"cm"),gp = gpar(fill = "grey")));;python /Users/yiranli/Dropbox/scripts/COMPLEXHEATMAP_LINE_PLOT.py >/Users/yiranli/Dropbox/master_assembly/clusering/4mer_lnc_cds/atgc_ratio;;p_order<-read.csv("/Users/yiranli/Dropbox/master_assembly/clusering/systematic_analysis/6mer/lnc_mrna_mrna/atgc_ratio",header = TRUE,sep = "\t");;;ha_line<-columnAnnotation(ATGC_percent=anno_lines(p_order,gp = gpar(col = c("red","blue","green","black")),height = unit(2,"cm")));;p<-Heatmap(seekr4,cluster_columns = TRUE,show_row_dend=FALSE,show_column_dend=FALSE,cluster_rows = TRUE,clustering_distance_rows = "euclidean",clustering_method_rows = "average",clustering_distance_columns = "pearson",clustering_method_columns = "average",show_column_names =FALSE,show_row_names = FALSE,right_annotation = ha_right,column_names_gp = gpar(fontsize = 5));;ha_line %v% p %v% ha_top;ha_line %v% ha_top %v% p ;;write.csv(column_order(p),file = "/Users/yiranli/Dropbox/master_assembly/clusering/systematic_analysis/6mer/lnc_mrna_mrna/order",quote = FALSE,sep = "\t",row.names = FALSE,col.names = FALSE);;##meme;meme inhost.fa  -dna -oc ./inhost2notin  -mod anr -nmotifs 5 -minw 4 -maxw 12 -objfun de  -neg ./64_Flc_not_inhost.fa;fimo --oc . --verbosity 1 --thresh 1.0E-4 --norc motifs.meme parastieESTinhost.fa.txt;;#rfam and small rna overlap;bedtools intersect -a /Users/yiranli/Dropbox/master_assembly/ATCC/rfam/ATCC_genome_relax.bed -b /Users/yiranli/Dropbox/master_assembly/ATCC/small_rna/small_block.gff -wao -s|awk '{if($NF!=0) print}'|sort -k15,15 -k5,5nr|sort -u -k15,15|awk '{if($5<1) print}'|awk '{print $1"\t"$10"\t"$11"\t"$4"\t"$15"\t"$13}';;;#line plot;dat<-read.csv("/Users/yiranli/Dropbox/master_assembly/ATCC/line_plot/position.tab",sep = "\t",header = TRUE);dat$middle<-(dat$start+dat$end)/2;order.scores <- order(dat$middle);dat1 <- dat[order.scores,];dat1$rank <- rank(dat1$middle);ggplot(data=dat1)+geom_segment(aes(x=start,y=rank,xend=end,yend=rank,color="red"))+geom_density(aes(start))+coord_cartesian(xlim = c(-100,200))